<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>MIND - Publicações por Autores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Bootstrap e ícones -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="css/style.css">
  
  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

  <script src="javascript/components/menu.js" defer></script>
  <script src="javascript/components/footer.js" defer></script>

  <style>
   
  #page-wrapper {
  display: flex;
  flex-direction: column;
  flex: 1; /* ocupa a altura disponível */
  min-height: 100vh; /* força ocupar a altura toda da tela */
  max-width: 100%;
  max-height: 90%;
  margin: auto; /* centraliza horizontal e vertical */
  overflow: auto; /* ativa scroll se o conteúdo for maior */
}
 
   /* Centraliza as 3 últimas colunas */

#tabelaAutores th:nth-child(4),
#tabelaAutores td:nth-child(2),
#tabelaAutores td:nth-child(3),
#tabelaAutores td:nth-child(3) {
    text-align: center;
    vertical-align: middle;
}

   /* Garante que a coluna do nome do autor apareça por completo em telas grandes */
  #tabelaAutores th:first-child,
  #tabelaAutores td:first-child {
    white-space: nowrap; /*nowrap sem quebra de linha, para quebra de linha wrap*/
    text-align: justify;

  }

  /* Ajusta a largura da coluna de "Total de Publicações" */
  #tabelaAutores th:last-child,
  #tabelaAutores td:last-child {
    text-align: center;
    white-space: wrap;   /*nowrap sem quebra de linha, para quebra de linha wrap*/
    width: 5%;
  }

  /* Em telas pequenas, permite quebra de linha para ambas as colunas */
  @media (max-width: 768px) {
    #tabelaAutores th,
    #tabelaAutores td {
      white-space: normal;
      word-wrap: break-word;
    }
  }

  #texto{
    text-align: center;
  }
</style>

</head>
<body>
  <meu-menu></meu-menu>
  <main class="container py-5">
    <h2 class="text-center text-danger"><strong>Movimento para Inclusão e Neurodiversidade</strong></h2>

    <!-- AUTORES E PUBLICAÇÕES -->
    <h3 class="text-center text-primary mb-4">Total de Publicações: como Autor e Co-autor</h3>
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="table-responsive container-fluid justify-content-center">
      <table id="tabelaAutores" class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Nome do Autor</th>
      <th>Autoria</th>
      <th>Co-autor</th>
      <th>Total</th>
    </tr>
    </thead>
    <tbody></tbody>
    </table>

    </div>
  </div>
</div>


  </main>
  <meu-footer></meu-footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  
  <script src="javascript/dados-publicacoes.js"></script>

  <script>
  const publicacoes = listarItens('publicacoes');

  const contagem = {};

  publicacoes.forEach(pub => {
    const autor = pub.autor?.trim();
    if (autor) {
      if (!contagem[autor]) contagem[autor] = { autor: 0, coautor: 0 };
      contagem[autor].autor += 1;
    }

    if (pub.coautor) {
      const coautores = pub.coautor.split(',').map(c => c.trim());
      coautores.forEach(coautor => {
        if (coautor) {
          if (!contagem[coautor]) contagem[coautor] = { autor: 0, coautor: 0 };
          contagem[coautor].coautor += 1;
        }
      });
    }
  });

  $(document).ready(function () {
    const tabela = $('#tabelaAutores').DataTable();
    Object.entries(contagem)
      .sort(([, a], [, b]) => (b.autor + b.coautor) - (a.autor + a.coautor))
      .forEach(([nome, dados]) => {
        const total = dados.autor + dados.coautor;
        tabela.row.add([nome, dados.autor, dados.coautor, total]);
      });
    tabela.draw();
  });
</script>

</body>
</html>
